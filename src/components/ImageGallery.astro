---
import OptimizedImage from './OptimizedImage.astro';

interface Props {
  images: string[];
  title?: string;
  columns?: 1 | 2 | 3 | 4;
  aspectRatio?: 'square' | 'video' | 'auto';
}

const { 
  images, 
  title, 
  columns = 3,
  aspectRatio = 'square'
} = Astro.props;

const gridCols = {
  1: 'grid-cols-1',
  2: 'grid-cols-1 md:grid-cols-2',
  3: 'grid-cols-1 md:grid-cols-2 lg:grid-cols-3',
  4: 'grid-cols-1 md:grid-cols-2 lg:grid-cols-4'
};

const aspectRatioClass = {
  'square': 'aspect-square',
  'video': 'aspect-video',
  'auto': 'aspect-auto'
};
---

<section class="py-8">
  {title && (
    <h2 class="text-3xl font-bold text-center mb-8">{title}</h2>
  )}
  
  <div class={`grid ${gridCols[columns]} gap-6`}>
    {images.map((image, index) => (
      <div
        data-image={image}
        class={`relative ${aspectRatioClass[aspectRatio]} cursor-pointer group gallery-image`}
      >
        <img
          src={image}
          alt={`Gallery image ${index + 1}`}
          class="w-full h-full object-cover rounded-lg transition-transform duration-300 group-hover:scale-105"
        />
        <div class="absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-colors duration-300 rounded-lg" />
      </div>
    ))}
  </div>

  {/* Lightbox */}
  <div
    id="lightbox"
    class="fixed inset-0 bg-black/90 z-50 flex items-center justify-center p-4 hidden"
  >
    <div class="relative max-w-4xl w-full">
      <button
        id="close-lightbox"
        class="absolute -top-12 right-0 text-white hover:text-gray-300"
      >
        Close
      </button>
      <div class="relative aspect-square">
        <img
          id="lightbox-image"
          src=""
          alt="Selected item"
          class="w-full h-full object-contain"
        />
      </div>
    </div>
  </div>
</section>

<script>
  const lightbox = document.getElementById('lightbox');
  const lightboxImage = document.getElementById('lightbox-image') as HTMLImageElement;
  const closeButton = document.getElementById('close-lightbox');
  const galleryImages = document.querySelectorAll('.gallery-image');

  galleryImages.forEach(image => {
    image.addEventListener('click', () => {
      const imageUrl = image.getAttribute('data-image');
      if (imageUrl && lightbox && lightboxImage) {
        lightboxImage.src = imageUrl;
        lightbox.classList.remove('hidden');
      }
    });
  });

  const closeLightbox = () => {
    if (lightbox) {
      lightbox.classList.add('hidden');
    }
  };

  closeButton?.addEventListener('click', closeLightbox);
  lightbox?.addEventListener('click', (e) => {
    if (e.target === lightbox) {
      closeLightbox();
    }
  });
</script> 