---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import AddressLink from '../components/AddressLink.astro';

// Hardcoded image URLs
const galleryImages = [
  "https://lyiiw7a2jaaujwge.public.blob.vercel-storage.com/clocks.webp",
  "https://xfcpn2nyfb.ufs.sh/f/LKapUqCN3UFsy80sfRDG1JbILFWOoMAgx7P49VvUj5rZXtNe",
  "https://xfcpn2nyfb.ufs.sh/f/LKapUqCN3UFsApRfExb1pPWKB2MoR9DLV5lmCjvsJGYxX3nw",
  "https://xfcpn2nyfb.ufs.sh/f/LKapUqCN3UFsqeVP8aAo2pXgV7HBurPdSzmyUO5CK9f0lx1s",
  "https://xfcpn2nyfb.ufs.sh/f/LKapUqCN3UFse4NPZbYKjfQh6uHwcvo0mnFrP8DByULaObG4",
  "https://xfcpn2nyfb.ufs.sh/f/LKapUqCN3UFssWQENxRiwGqRQXjaOTYzH816lIkchyoC9txN",
  "https://xfcpn2nyfb.ufs.sh/f/LKapUqCN3UFsED72c492bga4hAVdszcfGZt3vDSkFJe8rKwR",
  "https://xfcpn2nyfb.ufs.sh/f/LKapUqCN3UFsd1SLKG2VFBmf9HhQVLJpzkqGNjtM6ZlxcgPW",
];
---

<Layout title="Abingdon Antiques - Home">
  <!-- Preload first carousel image for better performance -->
  <link rel="preload" as="image" href={galleryImages[0]} fetchpriority="high">
  
  <a href="#main-content" class="skip-link" id="skip-link">Skip to main content</a>
  
  <Header />
  
  <main class="main-content" role="main" id="main-content">
    <section class="hero">
      <div class="container">
        <p class="hero-text">Discover unique antiques and collectibles in the heart of historic Abingdon, Virginia</p>
        <div class="hero-actions">
          <AddressLink class="btn btn-map" data-address="227 W Main St, Abingdon, VA 24210">
            <svg class="btn-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
            </svg>
            227 W Main St, Abingdon, VA
          </AddressLink>
          <a href="tel:276-477-1515" class="btn btn-phone">
            <svg class="btn-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
            </svg>
            Call Us
          </a>
        </div>
      </div>
    </section>

    <section class="carousel-section">
      <div class="container">
        <h2 class="section-title">Featured Items</h2>
        <div class="carousel-wrapper" role="region" aria-label="Featured items carousel">
          <div id="carousel" class="carousel">
            <div id="carousel-container" class="carousel-track" aria-live="polite" aria-atomic="true">
              {galleryImages.map((image, index) => (
                <div class="carousel-slide" role="group" aria-roledescription="slide" aria-label={`Slide ${index + 1} of ${galleryImages.length}`}>
                  <img
                    src={image}
                    alt={`Featured item ${index + 1}`}
                    class="carousel-img"
                    loading={index === 0 ? "eager" : "lazy"}
                    decoding="async"
                    data-image={image}
                    data-index={index}
                    tabindex="0"
                    role="button"
                    aria-label={`View full size image of featured item ${index + 1}`}
                    sizes="(max-width: 768px) 100vw, 768px"
                    fetchpriority={index === 0 ? "high" : "auto"}
                  />
                </div>
              ))}
            </div>
          </div>
          
          <div id="lightbox" class="lightbox hidden" role="dialog" aria-modal="true" aria-label="Image lightbox" aria-hidden="true">
            <div class="lightbox-inner">
              <img id="lightbox-image" src="" alt="Full size image" class="lightbox-img" loading="eager" decoding="async" sizes="90vw" />
              <button id="lightbox-close" class="lightbox-btn lightbox-close" aria-label="Close lightbox" type="button">&times;</button>
              <button id="lightbox-prev" class="lightbox-btn lightbox-prev" aria-label="Previous image" type="button">&lsaquo;</button>
              <button id="lightbox-next" class="lightbox-btn lightbox-next" aria-label="Next image" type="button">&rsaquo;</button>
              <div id="lightbox-counter" class="lightbox-counter">1 / {galleryImages.length}</div>
            </div>
          </div>
          
          <button id="carousel-prev" class="carousel-nav carousel-prev" aria-label="Previous image" type="button">
            <svg class="carousel-nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
          </button>
          <button id="carousel-next" class="carousel-nav carousel-next" aria-label="Next image" type="button">
            <svg class="carousel-nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
          </button>
          
          <div id="carousel-indicators" class="carousel-indicators" role="tablist" aria-label="Carousel navigation">
            {galleryImages.map((_, index) => (
              <button type="button" class="carousel-dot" data-index={index} aria-label={`Go to image ${index + 1}`} role="tab" aria-selected={index === 0 ? "true" : "false"}></button>
            ))}
          </div>
        </div>
      </div>
    </section>

    <section class="info-section">
      <div class="container">
        <div class="info-grid">
          <div class="info-card">
            <h3 class="info-card-title">Store Hours</h3>
            <div class="info-card-body">
              <div class="hours-row">
                <span class="hours-days">Monday - Saturday</span>
                <span class="hours-time">10:00 AM - 6:00 PM</span>
              </div>
              <div class="hours-row">
                <span class="hours-days">Sunday</span>
                <span class="hours-time">1:00 PM - 4:00 PM</span>
              </div>
              <div class="hours-note">
                <p>Closed on major holidays. Call ahead for holiday hours.</p>
              </div>
            </div>
          </div>
          <div class="info-card">
            <h3 class="info-card-title">Contact Us</h3>
            <div class="info-card-body">
              <p><strong>Phone:</strong> <a href="tel:276-477-1515">276-477-1515</a></p>
              <p><strong>Email:</strong> <a href="mailto:abingdonantiquesandmore@gmail.com">abingdonantiquesandmore@gmail.com</a></p>
              <p><strong>Address:</strong><br />
                <AddressLink>227 W Main St<br />Abingdon, VA 24210</AddressLink>
              </p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="about-section">
      <div class="container about-inner">
        <h2 class="section-title">About Our Store</h2>
        <p class="about-text">Abingdon Antiques and More Vendor Mall brings together a community of experienced dealers, each bringing their unique expertise and carefully curated inventory. Whether you're looking for fine furniture, rare collectibles, or unique home decor, you'll find something special at our store.</p>
        <p class="about-text">Visit us today and discover why we're becoming the region's premier destination for antiques and collectibles.</p>
        <div class="vendor-cta">
          <p><strong>Vendor space may be available!</strong> Call us at <a href="tel:276-477-1515">276-477-1515</a> to inquire about becoming a vendor.</p>
        </div>
      </div>
    </section>



    <section class="map-section">
      <div class="container">
        <h2 class="section-title">Find Us</h2>
        <div class="map-wrap">
          <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3211.835434509374!2d-81.97732168480109!3d36.70993598010572!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x88549183d6d8f777%3A0x5d08d6275db3b865!2s227%20W%20Main%20St%2C%20Abingdon%2C%20VA%2024210!5e0!3m2!1sen!2sus!4v1620000000000!5m2!1sen!2sus" width="100%" height="300" style="border:0;" allowfullscreen="" loading="lazy" class="map-iframe" title="Map: 227 W Main St, Abingdon, VA 24210"></iframe>
        </div>
      </div>
    </section>
  </main>

  <Footer />
</Layout>

<script>
  // Carousel functionality
  const carousel = document.getElementById('carousel-container');
  const slides = document.querySelectorAll('.carousel-slide');
  const indicators = document.querySelectorAll('.carousel-dot');
  const prevButton = document.getElementById('carousel-prev');
  const nextButton = document.getElementById('carousel-next');
  
  let currentSlide = 0;
  const totalSlides = slides.length;
  
  function updateCarousel() {
    if (carousel) {
      carousel.style.transform = `translateX(-${currentSlide * 100}%)`;
    }
    
    indicators.forEach((indicator, index) => {
      indicator.setAttribute('aria-selected', index === currentSlide ? 'true' : 'false');
    });
    
    // Update slide labels
    slides.forEach((slide, index) => {
      const slideElement = slide as HTMLElement;
      slideElement.setAttribute('aria-label', `Slide ${index + 1} of ${totalSlides}`);
    });
  }
  
  function nextSlide() {
    currentSlide = (currentSlide + 1) % totalSlides;
    updateCarousel();
  }
  
  function prevSlide() {
    currentSlide = (currentSlide - 1 + totalSlides) % totalSlides;
    updateCarousel();
  }
  
  // Event listeners
  nextButton?.addEventListener('click', nextSlide);
  prevButton?.addEventListener('click', prevSlide);
  
  indicators.forEach((indicator, index) => {
    indicator.addEventListener('click', () => {
      currentSlide = index;
      updateCarousel();
    });
  });
  
  // Auto-advance carousel
  let autoAdvance = setInterval(nextSlide, 5000);
  
  // Pause auto-advance on hover
  carousel?.addEventListener('mouseenter', () => {
    clearInterval(autoAdvance);
  });
  
  carousel?.addEventListener('mouseleave', () => {
    autoAdvance = setInterval(nextSlide, 5000);
  });
  
  // Touch/swipe support for mobile
  let startX = 0;
  let endX = 0;
  
  carousel?.addEventListener('touchstart', (e) => {
    startX = e.touches[0].clientX;
  });
  
  carousel?.addEventListener('touchend', (e) => {
    endX = e.changedTouches[0].clientX;
    handleSwipe();
  });
  
  function handleSwipe() {
    const swipeThreshold = 50;
    const diff = startX - endX;
    
    if (Math.abs(diff) > swipeThreshold) {
      if (diff > 0) {
        nextSlide();
      } else {
        prevSlide();
      }
    }
  }
  
  // Initialize carousel
  updateCarousel();
  
  // Skip link functionality
  const skipLink = document.getElementById('skip-link');
  const mainContent = document.getElementById('main-content');
  
  skipLink?.addEventListener('click', (e) => {
    e.preventDefault();
    if (mainContent) {
      mainContent.setAttribute('tabindex', '-1');
      mainContent.focus();
      // Remove tabindex after focus to prevent it from being in the tab order
      setTimeout(() => {
        mainContent.removeAttribute('tabindex');
      }, 100);
    }
  });
  
  // Lightbox functionality
  const lightbox = document.getElementById('lightbox');
  const lightboxImage = document.getElementById('lightbox-image');
  const lightboxClose = document.getElementById('lightbox-close');
  const lightboxPrev = document.getElementById('lightbox-prev');
  const lightboxNext = document.getElementById('lightbox-next');
  const lightboxCounter = document.getElementById('lightbox-counter');
  const carouselImages = document.querySelectorAll('.carousel-slide img');
  
  let lightboxCurrentIndex = 0;
  
  function showLightbox(index: number) {
    if (lightbox && lightboxImage && carouselImages[index]) {
      lightboxCurrentIndex = index;
      const imageSrc = carouselImages[index].getAttribute('data-image');
      if (lightboxImage instanceof HTMLImageElement && imageSrc) {
        lightboxImage.src = imageSrc;
      }
      
      // Update counter
      if (lightboxCounter) {
        lightboxCounter.textContent = `${index + 1} / ${carouselImages.length}`;
      }
      
      // Show lightbox
      lightbox.classList.remove('hidden');
      lightbox.setAttribute('aria-hidden', 'false');
      
      // Focus management
      const closeButton = document.getElementById('lightbox-close') as HTMLButtonElement;
      if (closeButton) {
        closeButton.focus();
      }
      
      // Pause carousel auto-advance
      clearInterval(autoAdvance);
    }
  }
  
  function hideLightbox() {
    if (lightbox) {
      lightbox.setAttribute('aria-hidden', 'true');
      lightbox.classList.add('hidden');
      
      // Return focus to the triggering element
      const currentImage = carouselImages[lightboxCurrentIndex] as HTMLElement;
      if (currentImage) {
        currentImage.focus();
      }
      
      // Resume carousel auto-advance
      autoAdvance = setInterval(nextSlide, 5000);
    }
  }
  
  function nextLightboxImage() {
    const nextIndex = (lightboxCurrentIndex + 1) % carouselImages.length;
    showLightbox(nextIndex);
  }
  
  function prevLightboxImage() {
    const prevIndex = (lightboxCurrentIndex - 1 + carouselImages.length) % carouselImages.length;
    showLightbox(prevIndex);
  }
  
  // Event listeners for lightbox
  carouselImages.forEach((image, index) => {
    image.addEventListener('click', () => {
      showLightbox(index);
    });
    
    // Keyboard support for carousel images
    image.addEventListener('keydown', (e) => {
      const keyEvent = e as KeyboardEvent;
      if (keyEvent.key === 'Enter' || keyEvent.key === ' ') {
        e.preventDefault();
        showLightbox(index);
      }
    });
  });
  
  lightboxClose?.addEventListener('click', hideLightbox);
  lightboxPrev?.addEventListener('click', prevLightboxImage);
  lightboxNext?.addEventListener('click', nextLightboxImage);
  
  // Close lightbox when clicking anywhere except navigation buttons
  lightbox?.addEventListener('click', (e) => {
    const target = e.target as HTMLElement;
    // Don't close if clicking on navigation buttons or the image itself
    if (target.id === 'lightbox-prev' || 
        target.id === 'lightbox-next' || 
        target.id === 'lightbox-close' ||
        target.closest('#lightbox-prev') ||
        target.closest('#lightbox-next') ||
        target.closest('#lightbox-close')) {
      return;
    }
    // Close for any other click (background, image, counter, etc.)
    hideLightbox();
  });
  
  // Close lightbox with Escape key
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && !lightbox?.classList.contains('hidden')) {
      hideLightbox();
    }
  });
  
  // Lightbox keyboard navigation
  document.addEventListener('keydown', (e) => {
    if (!lightbox?.classList.contains('hidden')) {
      if (e.key === 'ArrowLeft') {
        prevLightboxImage();
      } else if (e.key === 'ArrowRight') {
        nextLightboxImage();
      }
    }
  });
</script>
